# 概要 
ラズパイのネットワーク設定やソフトウェアの導入が構成を記述したファイルが入ったusbメモリをプスっとすればできちゃう、みたいな\\

# 動作スキーム 
  - まずusbをプスっとする
  - するとpatissierはこれを検知してUSBメモリの中身をチェックする。
  - patissierというディレクトリが存在する場合は丸ごとuser_home/bin/programs/stageにコピーする。処理開始の狼煙としてactをかなり短い間隔で点滅させる。カレントディレクトリもuser_home/bin/programs/stageにする。actを消灯する。
  - patissierの直下にrecipe.txtというファイルがあった場合は設定ファイルとみなしてこの記載内容に応じて処理を行う。一行終わるごとにピコピコっとledを点滅させる。
  - 処理終了したらactを点灯する。終了コードが1以上の場合はコードの値の分点滅させる。

# 設定ファイル 
assert,成功時,失敗時みたいな感じにする  
    --this is recipe.  
    ?@network w wpa2 ito@living password s 192.168.2.123 255.255.255.0 192.168.2.1 208.67.222.222  
    0@next  
    1@exit9  
    ?check_install_i2c.sh  
    0install_i2c.sh  
    1@next  
    2@exit9  
    ?delete_cache.sh  
    ?@exit0  
  - まずネットワーク設定
  - エラーレベル0で終われば次
  - 1ならエラーレベル9でインストール中止
  - check〜.shのエラーレベルが
  - 0ならinstaii_i2c.sh実行
  - 1なら何もしないで次
  - 2ならエラーレベル9でインストール中止
  - delete_cacheを実行
  - エラーレベル0.でインストール終わり

要するに  
  - 頭一文字が？ならスクリプト実行してエラーレベルに応じた後続を実行
  - 実行対象、あたまか@だったら組み込みコマンド的なもの(頭が@のシェルは禁止)
  - "--"はコメント

# 組み込みコマンド 
## network 
ネットワーク設定を行う。  
wifiの設定、設定検証用ping先ip(またはサーバ名)dhcpかstaticか、固定ipの値、デフォゲ、ネットマスク   
  * 有線接続の設定
''
    @network e [クライアント基本設定]
''
  * 無線接続接続の設定
''
    @network w [無線接続設定] [クライアント基本設定]
''

### クライアント基本設定
DHCP使用有無、IPアドレスの指定を記述する。

***書式***  
IPアドレス設定方式["s"　または "d"] ipアドレス ネットマスク デフォルトゲートウェイ DNS  

→接続方式にdを指定するとDHCPによるIpアドレスの設定を行います。  
接続方式をsにすると後続の引数に指定したアドレス情報に基づいて設定を行います。

### 無線接続設定 
無線LANの接続設定を記述する。

***書式***  
接続方式(現在は"wpa2"のみ) SID パスフレーズ

### 記述例 
  * 無線接続,SIDが"ito@living",パスフレーズが"abcdefgh"のアクセスポイントに接続し、DHCPで接続
''?@network w wpa2 ito@living abcdefgh d
''
  * 有線接続,IPアドレス192.168.2.123,ネットマスク24ビット,ゲートウェイ192.168.2.1として接続
''?@network e s 192.168.2.123 255.255.255.0 192.168.2.1
''


## validate 
ネットワーク接続状態の検証を行う。

### 引数 
  * サーバ名またはIP
  * エラーレベル（サーバ名IPで接続されていることが確認された場合に返すエラーレベル)
  * サーバ名またはIP、エラーレベル・・・（@validate server_a 0 server_b 1・・・）複数ペアを記述可
接続状態の評価は左から順に行い、接続が確認された段階で検証を終了する。\\
左側から右に行くに従い、検証ネットワークを狭めてゆくのがオススメ（@validate インターネット検証用IP 0 イントラネット 1 …)

### 備考 
どれにも該当しない場合は9を返す。
## exit 
処理を終了する
## next 
特に何もせず次に行く。
## set1〜set9 
エラーコードを設定する。
## reboot 
再起動する
## shutdown
電源を切る

# ログ 
刺したUSBメモリのpatissierディレクトリの直下に日付・時刻をファイル名とするファイルが2つ出力される。  
拡張子が[日付時刻].txtのものが通常のログ、  
拡張子が[日付時刻].std.txtのものがpatissier処理全体で標準出力・標準エラー出力に出力されたもの。  

## patissierで実行した自作スクリプトなどでログを出したい場合 
pattisier処理中は作業パス（/home/pi/bin/program/stage、デフォルトのカレントパス）の中にlogというシンボリックリンクが作られる。  
ここにリダイレクトすることにより、任意のログを出力できる。  
ex recipe.txt)  
''
?echo test >> log
''
ログに"test"の文字が出力される。
